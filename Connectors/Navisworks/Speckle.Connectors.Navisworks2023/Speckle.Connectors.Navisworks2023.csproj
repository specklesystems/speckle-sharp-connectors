<?xml version="1.0" encoding="utf-8"?>

<Project Sdk="Microsoft.NET.Sdk.WindowsDesktop">

  <PropertyGroup>
    <TargetFramework>net48</TargetFramework>
    <PlatformTarget>x64</PlatformTarget>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <FileAlignment>512</FileAlignment>
    <Deterministic>true</Deterministic>

    <NavisworksBuildNumber>v20</NavisworksBuildNumber>
    <NavisworksVersion>2023</NavisworksVersion>

    <UseWpf>true</UseWpf>
    <DefineConstants>$(DefineConstants);TRACE;NAVIS2023;NAVIS</DefineConstants>

    <Description>NextGen Speckle Connector for Autodesk Navisworks Manage</Description>
    <Authors>$(Authors) jonathon@speckle.systems</Authors>
    <PackageTags>$(PackageTags) connector nwd nwc nwf navisworks manage</PackageTags>

    <PluginBundleTarget>$(AppData)\Autodesk\ApplicationPlugins\Speckle.Connectors.Navisworksv3.bundle</PluginBundleTarget>
    <PluginVersionContentTarget>$(AppData)\Autodesk\ApplicationPlugins\Speckle.Connectors.Navisworksv3.bundle\Contents\$(NavisworksVersion)</PluginVersionContentTarget>
    <RootNamespace>Speckle.Connector.Navisworks</RootNamespace>

  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Speckle.Objects"/>
  </ItemGroup>

  <ItemGroup>
    <Reference Include="WindowsFormsIntegration"/>
  </ItemGroup>

  <!-- Configurations -->
  <PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
    <OutputPath>bin\x64\Debug\</OutputPath>
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(Configuration)' == 'Release' ">
    <OutputPath>bin\x64\Release\</OutputPath>
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>

  <!-- Includes -->
  <Import Project="..\Speckle.Connectors.NavisworksShared\Speckle.Connectors.NavisworksShared.projitems" Label="Shared"/>

  <!-- NUGETS -->
  <ItemGroup>
    <PackageReference Include="Speckle.Navisworks.API" VersionOverride="2023.0.0"/>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\..\Converters\Navisworks\Speckle.Converters.Navisworks2023\Speckle.Converters.Navisworks2023.csproj" />
    <ProjectReference Include="..\..\..\Sdk\Speckle.Connectors.Common\Speckle.Connectors.Common.csproj"/>
    <ProjectReference Include="..\..\..\DUI3\Speckle.Connectors.DUI.WebView\Speckle.Connectors.DUI.WebView.csproj"/>
    <ProjectReference Include="..\..\..\Sdk\Speckle.Converters.Common\Speckle.Converters.Common.csproj" />

  </ItemGroup>

  <!-- Post Builds -->
  <ItemGroup>
    <RibbonFiles Include="$(OutDir)Plugin\NavisworksRibbon.*"/>
    <ResourceFiles Include="$(OutDir)Resources\**\*.png"/>
    <ResourceFiles Include="$(OutDir)Resources\**\*.ico"/>
    <AllFiles Include="$(OutDir)*"/>
  </ItemGroup>

  <Target Name="PostBuild" AfterTargets="Build">
    <RemoveDir Directories="$(PluginVersionContentTarget)" Condition="Exists('$(PluginVersionContentTarget)')"/>

    <Copy SourceFiles="$(OutDir)Plugin\PackageContents.xml" DestinationFolder="$(PluginBundleTarget)\"/>
    <Copy SourceFiles="@(RibbonFiles)" DestinationFolder="$(PluginVersionContentTarget)\en-US\"/>
    <Copy SourceFiles="@(ResourceFiles)" DestinationFolder="$(PluginVersionContentTarget)\Resources\"/>

    <Copy SourceFiles="@(AllFiles)" DestinationFolder="$(PluginVersionContentTarget)\" />
  </Target>

</Project>
